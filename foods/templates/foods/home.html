{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
{% block css %}
<link rel="stylesheet" type="text/css" href="{% static 'CSS/foods/home/home.css' %}">
{% endblock css %}
{% block content %}
<div class="container" >
    <div class="d-flex flex-column align-items-center mt-3">
        <h1 class="fw-bold" style="font-size:2.5rem;">{{ team.name }}<h1>
        <p class="" style="color:gray; font-size:1.2rem;">{{ team.name }}ì˜ ë§¤ì  ì •ë³´ğŸ•</p>
    </div>
    <div class="symbol">
        <img class="team_logo" src="{{ team.mascot.url }}" alt="">
        <div id="map" style="width:100%;height:400px;"></div>
    </div>
    <form class="d-flex" role="search" method='GET' action="{% url 'foods:search' team.pk %}">
        <select class="select border rounded me-2" aria-label="Default select example" name='field'>
          <option value="1">ë‚´ë¶€ ë§¤ì¥</option>
          <option value="2">ì™¸ë¶€ ë§¤ì¥</option>
          <option value="3">ë¦¬ë·°</option>
        </select>
        <input class="form-control me-2" type="search" placeholder="ê²Œì‹œê¸€ ê²€ìƒ‰" name='searched'>
    
        <button class="btn btn-dark me-2" type="submit" style="width: 7rem;">ê²€ìƒ‰</button>
      </form>
    <div class="container text-center py-3" style="border-top: 1rem groove {{ team.color }}; border-bottom: 1rem groove {{ team.color }}">
        <div class="d-flex flex-column align-items-center mt-3">
            <h2 class="fw-bold" style="font-size:2.5rem;">êµ¬ì¥ ë‚´ ìŠ¤ë‚µë°”</h2>
            <p class="" style="color:gray; font-size:1.2rem;">êµ¬ì¥ ë‚´ ìŠ¤ë‚µë°” ì •ë³´</p>
            <div class="badge rounded-pill text-bg-dark fw-bold" style="width:100px; height:30px;font-size:17px;">ì „ì²´ ë³´ê¸°</div>
        </div>

    <!-- ì¹´ë“œ ìŠ¬ë¼ì´ë” íš¨ê³¼ -->
      <div class='slider'>

        <div class='slide-track'>
        {% for store, store_img in store_lst %}
          <div class='slide'>
            <div class="train-card bg-white" style="width:350px;">
              <a href="">
                <img src="{{store_img.image.url}}" class="card-img-top" alt="...">
              </a>
              <div class="card-body py-2 border-top">
                <h5 class="card-title text-center">{{ store.name }}</h5>
                <p class="small m-0 ms-3">ë§¤ì¥ ìœ„ì¹˜ : {{ store.detail }}</p>
                <p class="card-text small ms-3">
                  ë©”ë‰´ : {{ store.items }}
                </p>
              </div>
            </div>
          </div>
        {% endfor %}

          <!-- í•œë²ˆ ë” ë°˜ë³µí•˜ê¸° -->

          
        {% for store, store_img in store_lst %}
          <div class='slide'>
            <div class="train-card bg-white" style="width:350px;>
              <a href="">
                <img src="{{store_img.image.url}}" class="card-img-top" alt="...">
              </a>
              <div class="card-body py-2 border-top">
                <h5 class="card-title text-center">{{ store.name }}</h5>
                <p class="small m-0 ms-3">ë§¤ì¥ ìœ„ì¹˜ : {{ store.detail }}</p>
                <p class="card-text small ms-3">
                  ë©”ë‰´ : {{ store.items }}
                </p>
              </div>
            </div>
          </div>
        {% endfor %}


        </div>
      </div>
    </div>
    <h1>ì—¬ê¸°ì— í˜ì´ì§€</h1>
</div>
<div>
    <div class="container text-center py-3" style="border-top: 1rem ridge {{ team.color }}; border-bottom: 1rem ridge {{ team.color }}">
        <div class="d-flex flex-column align-items-center mt-3">
            <h2 class="fw-bold" style="font-size:2.5rem;">ì£¼ë³€ ë§›ì§‘</h2>
            <p class="" style="color:gray; font-size:1.2rem;">ê°€ì¥ ì¸ê¸°ìˆëŠ” ë¦¬ë·°ë¥¼ ì°¾ì•„ë³´ì„¸ìš”ğŸ’¯</p>
        </div>
        <div class="row row-cols-1 row-cols-md-5 g-4 d-flex justify-content-around">
            <div class="col">
                <div class="card">
                    <img src="{% static 'images/home/Eagle/symbol.jpg' %}" class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">Card title</h5>
                        <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card">
                    <img src="{% static 'images/home/Eagle/symbol.jpg' %}" class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">Card title</h5>
                        <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card">
                    <img src="{% static 'images/home/Eagle/symbol.jpg' %}" class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">Card title</h5>
                        <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional content.</p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card">
                    <img src="{% static 'images/home/Eagle/symbol.jpg' %}" class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">Card title</h5>
                        <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                    </div>
                </div>
            </div>
        </div>
        <a class='btn btn-primary' href='{% url "foods:restaurant_create" team.pk %}'>ê°€ê²Œ ì¶”ê°€í•˜ê¸°</a>
        <h1>ì—¬ê¸°ì— í˜ì´ì§€</h1>
        
    </div>
</div>
</div>
{% block script %}
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=6bd32552e80c3bdb46ce44eb2fd8bdcc&libraries=services"></script>
<script>
    var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div  
    mapOption = { 
        center: new kakao.maps.LatLng({{ stadium.lat }}, {{ stadium.lon }}), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
        level: 2 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
    };
var map = new kakao.maps.Map(mapContainer, mapOption); // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
var new_dicts = {};
var positions = [];
// ë§ˆì»¤ë¥¼ í‘œì‹œí•  ìœ„ì¹˜ì™€ title ê°ì²´ ë°°ì—´ì…ë‹ˆë‹¤ 
    {% for store in stores %}
        var name = "{{ store.name }}";
        var lat = {{ store.lat }};
        var lon = {{ store.lon }};
        new_dicts['name'] = name;
        new_dicts['latlng'] = new kakao.maps.LatLng(lat,lon)
        new_dicts['pk'] = {{ store.pk }}
        new_dicts['address'] = "{{ store.detail }}"
        new_dicts['image'] = "{{ store.store_image }}"
        positions.push(new_dicts);
        var new_dicts = {};
    {% endfor %}
// ë§ˆì»¤ ì´ë¯¸ì§€ì˜ ì´ë¯¸ì§€ ì£¼ì†Œì…ë‹ˆë‹¤
var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png"; 
// ë§ˆì»¤ ì´ë¯¸ì§€ì˜ ì´ë¯¸ì§€ í¬ê¸° ì…ë‹ˆë‹¤
var imageSize = new kakao.maps.Size(24, 35); 
// ë§ˆì»¤ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤    
var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize); 
    
positions.forEach(function (pos) {
    // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
    var marker = new kakao.maps.Marker({
        map: map, // ë§ˆì»¤ë¥¼ í‘œì‹œí•  ì§€ë„
        position: pos.latlng, // ë§ˆì»¤ë¥¼ í‘œì‹œí•  ìœ„ì¹˜
        image : markerImage // ë§ˆì»¤ ì´ë¯¸ì§€ 
    });
    var content = document.createElement("div");
    var content_middle = document.createElement("div");
    var content_div = document.createElement("div");
    
    content.className = 'overlay';
    content_middle.className = "overlay_middle";
    content_div.className = 'overlay_name';
    content_div.innerHTML = pos.name;
    content_middle.appendChild(content_div);
    var closeBtn = document.createElement("button");
    var quitBtn = document.createElement("p");
    quitBtn.innerHTML = "âŒ";
    closeBtn.appendChild(quitBtn)
    closeBtn.onclick = function() {
        overlay.setMap(null);
    }
    content_middle.appendChild(closeBtn);
    content.appendChild(content_middle);
    if ( {{ team.pk }} === 3) {
        content.insertAdjacentHTML('beforeend', `
        <div class="content_add">
            <p>ì—¬ê¸° ì´ë¯¸ì§€ ì–´ë–»ê²Œ ë„£ì§€</p>
            <div class="content_text">
                <a class="address" href="/foods/9/store/${pos.pk}">
                    ${pos.address}
                </a>
            </div>
        </div>
    `);
    }
    else {
    content.insertAdjacentHTML('beforeend', `
    <div class="content_add">
        <p>ì—¬ê¸° ì´ë¯¸ì§€ ì–´ë–»ê²Œ ë„£ì§€</p>
        <div class="content_text">
            <a class="address" href="/foods/{{ team.pk }}/store/${pos.pk}">
                ${pos.address}
            </a>
        </div>
    </div>
    `);
    }
    var overlay = new kakao.maps.CustomOverlay({
        {% comment %} clickable: true, {% endcomment %}
        content: content,
        position: pos.latlng,
        xAnchor: 0.5,
        yAnchor: 1.5,
    });
    kakao.maps.event.addListener(marker, 'click', function() {
        overlay.setMap(map);
    });
});
var coords = new kakao.maps.LatLng({{ stadium.lat }}, {{ stadium.lon }});
var marker = new kakao.maps.Marker({
    map: map,
    position: coords
});
{% comment %} for (var i = 0; i < positions.length; i ++) {
    // ë§ˆì»¤ì— í‘œì‹œí•  ì¸í¬ìœˆë„ìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤ 
    var infowindow = new kakao.maps.InfoWindow({
        content: positions[i].content // ì¸í¬ìœˆë„ìš°ì— í‘œì‹œí•  ë‚´ìš©
    });
    // ë§ˆì»¤ì— mouseover ì´ë²¤íŠ¸ì™€ mouseout ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¡œëŠ” í´ë¡œì €ë¥¼ ë§Œë“¤ì–´ ë“±ë¡í•©ë‹ˆë‹¤ 
    // forë¬¸ì—ì„œ í´ë¡œì €ë¥¼ ë§Œë“¤ì–´ ì£¼ì§€ ì•Šìœ¼ë©´ ë§ˆì§€ë§‰ ë§ˆì»¤ì—ë§Œ ì´ë²¤íŠ¸ê°€ ë“±ë¡ë©ë‹ˆë‹¤
    kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
    kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
} {% endcomment %}
var customOverlay = new kakao.maps.CustomOverlay({
    map: map,
    clickable: true,
    content: '<div class="customOverlay">{{ stadium.name }}</div>',
    position: new kakao.maps.LatLng({{ stadium.lat }}, {{ stadium.lon }}),
    xAnchor: 0.5,
    yAnchor: 2,
    
});
customOverlay.setMap(null)
// ë§ˆì»¤ì— ë§ˆìš°ìŠ¤ì˜¤ë²„ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
kakao.maps.event.addListener(marker, 'mouseover', function() {
    // ë§ˆì»¤ì— ë§ˆìš°ìŠ¤ì˜¤ë²„ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì¸í¬ìœˆë„ìš°ë¥¼ ë§ˆì»¤ìœ„ì— í‘œì‹œí•©ë‹ˆë‹¤
    customOverlay.setMap(map)
  });
  
// ë§ˆì»¤ì— ë§ˆìš°ìŠ¤ì•„ì›ƒ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
kakao.maps.event.addListener(marker, 'mouseout', function() {
    // ë§ˆì»¤ì— ë§ˆìš°ìŠ¤ì•„ì›ƒ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì¸í¬ìœˆë„ìš°ë¥¼ ì œê±°í•©ë‹ˆë‹¤
    customOverlay.setMap(null)
});
</script>
{% endblock script %}
{% endblock content %}